import{_ as S,u as U,c as f,o as c,w as a,a as F,F as A,r as N,b as _,d as m,e as o,t as h,E as D,f as T,g as $,h as j,i as H,j as P,k as E,l as x,m as R,n as z}from"./index-Alo-18dM.js";import{u as b,E as G,a as B,b as J,c as K,d as O,e as Q}from"./shoplist-B6hHvV-I.js";import{E as W,a as w,u as X,_ as Y}from"./shoppingCart-8rZk9ciG.js";const Z={__name:"Shopmain",props:{modelValue:{type:Array,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(y){const r=b(),e=U(y,"modelValue"),p=(u,g)=>{for(let n=0;n<r.shops.length;n++)if(r.shops[n].id===u.id)if(r.shops[n].total<=0){w({message:"该商品库存不足！",type:"warning"});return}else r.shops[n].total-=1;let d=!0;for(let n=0;n<e.value.length;n++)if(e.value[n].id===u.id){e.value[n].quantity+=1,d=!1;return}d&&(e.value.push({...u,quantity:1}),delete e.value[e.value.length-1].total)};return(u,g)=>{const d=G,n=D,l=W,t=B;return c(),f(t,{class:"side"},{default:a(()=>[(c(!0),F(A,null,N(_(r).shops,(s,i)=>(c(),f(l,{class:"card",key:i,shadow:"hover"},{default:a(()=>[(c(),f(d,{src:s.path,class:"image",key:i,style:{width:"200px",height:"230px"},alt:"Shop Image"},null,8,["src"])),m("div",null,[m("p",null,"商品名称: "+h(s.name),1),m("p",null,"价格: ¥"+h(s.price),1),m("p",null,"剩余数量："+h(s.total),1)]),o(n,{class:"icon",onClick:V=>p(s,i)},{default:a(()=>[o(_(T))]),_:1},8,["onClick"])]),_:2},1024))),128))]),_:1})}}},ee=S(Z,[["__scopeId","data-v-fd6d1fa8"]]),te={__name:"main",setup(y){const r=b(),e=X().cart,p=()=>{for(;e.length>0;){let l=e.pop(),t=r.shops.findIndex(s=>s.id===l.id);t!==-1&&(r.shops[t].total+=l.quantity)}},u=$(()=>e.reduce((l,t)=>l+t.price*t.quantity,0).toFixed(2)),g=()=>{if(u.value<=0){w({message:"请选择商品！",type:"warning"});return}w.closeAll(),z.push({path:"/settlement"})},d=l=>{e.length>0&&(l.preventDefault(),l.returnValue="购物车中有商品，刷新页面将自动退货。确定要刷新吗？")},n=()=>{e.length>0&&p()};return j(()=>{window.addEventListener("beforeunload",d),window.addEventListener("unload",n)}),H(()=>{window.removeEventListener("beforeunload",d),window.removeEventListener("unload",n)}),(l,t)=>{const s=P("router-link"),i=J,V=ee,I=K,k=B,L=Y,C=R,q=Q,M=O;return c(),f(k,{class:"base"},{default:a(()=>[o(k,{class:"left-main"},{default:a(()=>[o(i,{class:"header"},{default:a(()=>[o(s,{to:"/admin"},{default:a(()=>[...t[2]||(t[2]=[E("管理员登录",-1)])]),_:1})]),_:1}),o(I,{class:"main"},{default:a(()=>[o(V,{modelValue:_(e),"onUpdate:modelValue":t[0]||(t[0]=v=>x(e)?e.value=v:null)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,{class:"aside"},{default:a(()=>[o(L,{class:"shopcart",modelValue:_(e),"onUpdate:modelValue":t[1]||(t[1]=v=>x(e)?e.value=v:null)},null,8,["modelValue"]),o(q,{class:"footer"},{default:a(()=>[o(C,{type:"default",class:"reset",onClick:p},{default:a(()=>[...t[3]||(t[3]=[E("重选",-1)])]),_:1}),o(C,{type:"primary",class:"settlement",onClick:g},{default:a(()=>[E("去结算¥"+h(_(u)),1)]),_:1})]),_:1})]),_:1})]),_:1})}}},le=S(te,[["__scopeId","data-v-c5678b28"]]);export{le as default};
